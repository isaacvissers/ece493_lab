# Acceptance Test Suite — UC-28 Edit and Update the Conference Schedule

## Scope
Validate that an editor can modify schedule entries to fix conflicts or issues and that CMS:
- allows authorized editing of room/time assignments,
- validates changes (no double booking, within time window, paper scheduled once),
- persists changes and reflects them in schedule views (including HTML view),
- handles unscheduling policy, missing schedule, authorization failure,
- handles DB failures and concurrent edits safely,
- optionally handles publish/notification failures without losing saved changes.

Covers UC-28 extensions (6a, 6b, 5a, 4a, 3a, 7a, 6c, 8a).

## Assumptions / Notes
- Schedule may have draft/published states. Tests focus on correctness of stored schedule after update.
- Unscheduling policy is not specified; tests describe acceptable behaviors.
- Concurrency handling may use optimistic locking/version checks or last-write-wins; acceptance expects protection against silent overwrite (version mismatch warning or conflict resolution).

---

## Test Data
- **Editor (authorized)**: `editor1@example.com`
- **Editor (unauthorized)**: `editorX@example.com`
- **Conference**: `CONF-04`
- **Schedule exists**: Yes for `CONF-04` (draft or published)
- **No schedule conference**: `CONF-05`
- Rooms: `Room A`, `Room B`
- Time slots: 09:00–09:30, 09:30–10:00 (example)
- Papers:
  - `PAPER-200` scheduled in Room A 09:00–09:30
  - `PAPER-201` scheduled in Room A 09:30–10:00
  - `PAPER-202` scheduled in Room B 09:00–09:30
- Failure simulations:
  - DB write failure on save
  - Concurrent edit (two editors/users edit same schedule entry)
  - Notification/publish failure (optional)

---

# Test Cases

## AT-UC28-01 — Authorized editor updates a schedule entry successfully (Happy Path)
**Objective:** Confirm edit + validation + persistence works.  
**Preconditions:** Schedule exists; editor1 logged in.  
**Steps:**
1. Open schedule for `CONF-04`.
2. Select `PAPER-200` entry (Room A 09:00–09:30) and click **Edit**.
3. Change assignment to Room B 09:00–09:30 (if free) or another free slot.
4. Save.
**Expected Results:**
- System validates the new assignment.
- Update is saved successfully.
- Confirmation message shown.
- Schedule view reflects updated assignment.

---

## AT-UC28-02 — Updated schedule appears correctly in HTML schedule view
**Objective:** Ensure downstream views reflect saved updates.  
**Preconditions:** AT-UC28-01 completed.  
**Steps:**
1. Open **View Schedule (HTML)**.
2. Locate `PAPER-200` in the HTML schedule.
**Expected Results:**
- HTML schedule shows the updated time/room assignment.
- No duplicate listings exist for the same paper.

---

## AT-UC28-03 — Attempt to save a conflicting room-time assignment is blocked (Extension 6a)
**Objective:** Prevent double-booking conflicts.  
**Preconditions:** `PAPER-201` occupies Room A 09:30–10:00.  
**Steps:**
1. Edit `PAPER-202` entry.
2. Attempt to move it to Room A 09:30–10:00 (occupied).
3. Save.
**Expected Results:**
- Save blocked.
- Error indicates room-time conflict and identifies conflicting entry.
- No schedule changes are persisted.

---

## AT-UC28-04 — Attempt to move paper outside conference time window is blocked (Extension 6b)
**Objective:** Ensure edits stay within configured window.  
**Preconditions:** Conference window configured (e.g., 09:00–17:00).  
**Steps:**
1. Edit a schedule entry.
2. Select an out-of-window time slot (e.g., 18:00).
3. Save.
**Expected Results:**
- Save blocked.
- Error indicates allowed conference time range.
- No schedule changes are persisted.

---

## AT-UC28-05 — Removing an entry leaves paper unscheduled or is blocked according to policy (Extension 5a)
**Objective:** Validate unscheduling behavior.  
**Preconditions:** Schedule exists; editor1 logged in.  
**Steps:**
1. Edit `PAPER-200` entry and click **Remove from schedule** (if available).
**Expected Results (Acceptable outcomes):**
- **Option A (Allowed):** paper is removed and appears as **Unscheduled** in schedule views (and/or “Unscheduled” section in HTML).  
- **Option B (Blocked):** system blocks removal and requires assignment to be set before saving.  
In either case, behavior is consistent and clearly communicated.

---

## AT-UC28-06 — No schedule exists: editing is unavailable and user is guided (Extension 4a)
**Objective:** Graceful handling when schedule does not exist.  
**Preconditions:** No schedule exists for `CONF-05`.  
**Steps:**
1. Editor opens scheduling area for `CONF-05`.
2. Attempts to edit schedule.
**Expected Results:**
- System shows “No schedule available” message.
- No editing controls for nonexistent schedule.
- Link/prompt to generate schedule (UC-26) may be shown.

---

## AT-UC28-07 — Unauthorized editor cannot edit schedule (Extension 3a)
**Objective:** Enforce authorization for schedule modifications.  
**Preconditions:** editorX lacks schedule edit permission.  
**Steps:**
1. Log in as editorX.
2. Attempt to edit any schedule entry.
**Expected Results:**
- Editing controls are hidden/disabled or access denied on action.
- No changes are saved.
- Attempt logged (if logging exists).

---

## AT-UC28-08 — DB write failure prevents saving and schedule remains unchanged (Extension 7a)
**Objective:** Ensure safe failure on persistence.  
**Preconditions:** Simulate DB failure on save.  
**Steps:**
1. Editor makes a valid change to a schedule entry.
2. Save while DB failure is active.
3. Refresh schedule view.
**Expected Results:**
- System shows error: update could not be saved.
- Failure logged for admin review.
- Schedule remains unchanged after refresh (no partial update).

---

## AT-UC28-09 — Concurrent edit: version mismatch detected and editor must refresh (Extension 6c)
**Objective:** Prevent silent overwrite during concurrent editing.  
**Preconditions:** Two sessions: editor1 and admin1 (or editor2) both authorized.  
**Steps:**
1. Session A opens edit screen for `PAPER-200` but does not save yet.
2. Session B edits and saves `PAPER-200` to a new slot.
3. Session A attempts to save its old edit.
**Expected Results:**
- System detects schedule changed (version mismatch) and blocks or warns before overwrite.
- Session A must refresh/reload the latest schedule and re-apply changes.
- No silent loss of Session B’s update occurs.

---

## AT-UC28-10 — Publish/notification failure after save does not roll back changes (Extension 8a, optional)
**Objective:** Ensure notifications are decoupled from schedule persistence.  
**Preconditions:** Notifications/publish enabled; simulate failure after save.  
**Steps:**
1. Editor saves a schedule update successfully.
2. Trigger notify/publish and force failure.
3. Refresh schedule view.
**Expected Results:**
- Schedule change remains saved and visible.
- Notification/publish failure is logged and can be retried.
- No rollback of saved schedule changes occurs.

---

# Exit Criteria (Definition of Done for UC-28)
UC-28 is accepted when:
- Authorized editors can update schedule entries and changes appear in all schedule views (AT-UC28-01, AT-UC28-02), and
- Conflicts and out-of-window edits are blocked with clear feedback (AT-UC28-03, AT-UC28-04), and
- Unscheduling behavior is consistent and clearly communicated (AT-UC28-05), and
- Missing schedule and authorization restrictions are handled safely (AT-UC28-06, AT-UC28-07), and
- DB and concurrency failures are handled without corrupting schedule state (AT-UC28-08, AT-UC28-09), and
- Optional notification/publish failures do not roll back saved changes (AT-UC28-10, if applicable).
