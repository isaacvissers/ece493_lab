# Acceptance Test Suite — UC-15 Notify Editor of Assignment Rule Violations

## Scope
Validate that when an editor assigns referees and an assignment rule is violated, CMS:
- detects the violation(s),
- clearly notifies the editor of what went wrong and which entry caused it,
- blocks invalid assignment creation,
- supports correction and retry,
including extensions for multiple violations, UI notification failures, rule evaluation failures, and partial vs all-or-nothing behavior.

Covers UC-15 extensions (4a, 5a, 3a, 6a, 6b).

## Assumptions / Notes
- Assignment rules include at least: valid email format, no duplicates, and reviewer workload limit (max 5 papers per reviewer).
- Notification may be inline/summary banner/toast; tests validate that feedback is visible and actionable.
- System may be configured for partial-apply or all-or-nothing behavior; acceptance criteria allow either if implemented consistently and communicated clearly.

---

## Test Data
- **Editor account**: `editor1@example.com` (role: Editor)
- **Eligible paper**: `PAPER-020` (status: Submitted/Eligible)
- **Reviewer at limit**: `at.limit@example.com` (5 assigned papers)
- **Reviewer under limit**: `under.limit@example.com` (4 assigned papers)
- **Invalid email**: `bad.email@`
- **Duplicate**: `dup@example.com` entered twice

---

# Test Cases

## AT-UC15-01 — Invalid email triggers rule violation notification and blocks assignment
**Objective:** Ensure invalid input is detected and communicated.  
**Preconditions:** Logged in as Editor; `PAPER-020` eligible.  
**Steps:**
1. Open **Assign Referees** for `PAPER-020`.
2. Enter `bad.email@`.
3. Confirm assignment.
**Expected Results:**
- System detects invalid email rule violation.
- Visible error message identifies invalid email format and points to the offending entry/field.
- Assignment is not created for `bad.email@`.
- Editor remains able to correct and retry.

---

## AT-UC15-02 — Workload limit violation triggers notification and blocks assignment
**Objective:** Ensure workload limit violations are notified.  
**Preconditions:** `at.limit@example.com` has 5 assignments; Editor logged in.  
**Steps:**
1. Attempt to assign `at.limit@example.com` to `PAPER-020`.
**Expected Results:**
- System detects “reviewer at limit” violation.
- Error message indicates max 5 assigned papers reached.
- No assignment record is created.

---

## AT-UC15-03 — Duplicate entry triggers notification and is handled
**Objective:** Ensure duplicates are caught and communicated.  
**Preconditions:** Editor logged in; paper eligible.  
**Steps:**
1. Enter `dup@example.com` twice in assign list.
2. Confirm assignment.
**Expected Results (if duplicates are blocking):**
- System displays violation message about duplicate entry.
- Assignment is blocked until corrected.
**Expected Results (if duplicates are auto-removed):**
- System warns about duplicates and proceeds with unique value.
- Only one assignment record exists for `dup@example.com`.
- Notification explains what happened.

---

## AT-UC15-04 — Multiple violations are reported together (Extension 4a)
**Objective:** Ensure comprehensive feedback for multiple issues.  
**Preconditions:** Editor logged in.  
**Steps:**
1. Enter `bad.email@`, `at.limit@example.com`, and `dup@example.com` twice.
2. Confirm assignment.
**Expected Results:**
- System reports all detected violations (invalid email, workload limit, duplicates) in one response or clearly highlights each issue.
- No invalid assignments are created.
- Editor can correct issues and retry.

---

## AT-UC15-05 — Correction and retry succeeds after violations
**Objective:** Ensure editor can recover by fixing inputs.  
**Preconditions:** Start from a failing attempt (AT-UC15-01/02/04).  
**Steps:**
1. Replace invalid entries with a valid under-limit reviewer (e.g., `under.limit@example.com`).
2. Remove duplicate entries so each reviewer appears once.
3. Confirm assignment.
**Expected Results:**
- No violation messages remain.
- Assignment succeeds and confirmation is shown.
- Database reflects the valid assignment(s) only.

---

## AT-UC15-06 — Notification UI failure still blocks invalid assignments and provides alternate feedback (Extension 5a)
**Objective:** Ensure fail-safe behavior if UI messaging fails.  
**Preconditions:** Simulate UI notification component failure; Editor logged in.  
**Steps:**
1. Attempt an assignment that violates a rule (e.g., invalid email).
2. Observe UI behavior.
**Expected Results:**
- Invalid assignment is still blocked (no assignment record created).
- System logs UI notification failure.
- Alternate feedback is provided (field highlight, error summary region, or “Assignment failed” status) so editor can correct.

---

## AT-UC15-07 — Rule evaluation failure blocks assignment and notifies editor (Extension 3a)
**Objective:** Ensure fail-safe when system cannot evaluate rules.  
**Preconditions:** Simulate DB/lookup failure that prevents computing reviewer workload or existing assignments.  
**Steps:**
1. Attempt to assign a reviewer to `PAPER-020`.
**Expected Results:**
- System blocks the assignment (fail safe).
- Message indicates assignment cannot be completed at this time.
- Failure is logged for administrator review.
- No assignment record is created.

---

## AT-UC15-08 — Partial-apply behavior (Extension 6a) OR all-or-nothing behavior (Extension 6b)
**Objective:** Validate consistent system behavior for mixed valid/invalid entries.  
**Preconditions:** Editor logged in; system policy known (partial or all-or-nothing).  
**Steps:**
1. Enter two reviewers: `under.limit@example.com` (valid) and `at.limit@example.com` (violates limit).
2. Confirm assignment.
**Expected Results (Partial-apply):**
- Valid reviewer assignment is saved.
- Invalid reviewer is blocked with clear reason.
- Summary indicates which were saved vs rejected.
**Expected Results (All-or-nothing):**
- No assignments are saved.
- System reports violation(s) and instructs correction.
- Summary clearly indicates none were applied.

---

# Exit Criteria (Definition of Done for UC-15)
UC-15 is accepted when:
- Violations are detected and communicated clearly and specifically (AT-UC15-01 to AT-UC15-04), and
- Invalid assignments are never created when rules fail (all relevant tests), and
- Editors can correct and retry successfully (AT-UC15-05), and
- System fails safely and communicates issues when evaluation or UI feedback fails (AT-UC15-06, AT-UC15-07), and
- Mixed valid/invalid batch behavior is consistent and clearly summarized (AT-UC15-08).
