# Acceptance Test Suite — UC-13 Assign Referees to Submitted Papers

## Scope
Validate that an **editor** can assign one or more referees to a submitted paper using email addresses, and that CMS:
- enforces editor permissions,
- ensures paper is eligible for assignment,
- validates referee email inputs (non-blank, valid format),
- prevents duplicates (within entry list and already-assigned cases),
- persists assignments reliably,
- handles notification failures gracefully (if notifications exist).

Covers UC-13 extensions (1a, 2a, 6a, 7a, 7b, 8a, 8b, 9a).

## Assumptions / Notes
- “Submitted” status is eligible; other statuses may not be.
- Whether referees must already have accounts is not specified; assignments are keyed by email.
- If notification is not implemented, skip notification-specific checks.

---

## Test Data
Create or have:
- **Editor account**: `editor1@example.com` (role: Editor)
- **Non-editor account**: `user1@example.com` (role: Author/Registered User)
- **Submitted paper**: `PAPER-001` (status: Submitted)
- **Ineligible paper**: `PAPER-002` (status: Withdrawn or Finalized)

Referee emails:
- Valid referee emails: `ref1@example.com`, `ref2@example.com`
- Invalid email: `ref1@`
- Duplicate entry list: `ref1@example.com`, `ref1@example.com`

---

# Test Cases

## AT-UC13-01 — Editor can assign referees to an eligible submitted paper (Happy Path)
**Objective:** Validate successful assignment flow.  
**Preconditions:** Logged in as Editor; `PAPER-001` is Submitted.  
**Steps:**
1. Navigate to submitted papers list.
2. Open `PAPER-001`.
3. Select **Assign Referees**.
4. Enter `ref1@example.com` and `ref2@example.com`.
5. Confirm assignment.
**Expected Results:**
- System validates emails.
- Assignments are saved in DB linked to `PAPER-001`.
- Confirmation message shown.
- Paper details show assigned referees list includes ref1 and ref2.

---

## AT-UC13-02 — Non-editor cannot access referee assignment (Extension 1a)
**Objective:** Enforce permissions.  
**Preconditions:** Logged in as non-editor `user1@example.com`.  
**Steps:**
1. Attempt to open `PAPER-001` and access **Assign Referees**.
**Expected Results:**
- System denies access to assignment feature.
- Authorization error shown (or assignment UI hidden).
- No assignments can be created.

---

## AT-UC13-03 — Unauthenticated user is redirected to login (Extension 1a)
**Objective:** Enforce authentication.  
**Preconditions:** Logged out.  
**Steps:**
1. Attempt to access assign referees page/route directly.
**Expected Results:**
- System redirects to login.
- Assignment action is unavailable until login.

---

## AT-UC13-04 — Ineligible paper cannot have referees assigned (Extension 2a)
**Objective:** Ensure only eligible papers can be assigned.  
**Preconditions:** Logged in as Editor; `PAPER-002` status is ineligible.  
**Steps:**
1. Open `PAPER-002`.
2. Attempt **Assign Referees**.
**Expected Results:**
- System blocks assignment.
- Message indicates paper cannot be assigned in current state.
- No assignments saved.

---

## AT-UC13-05 — Blank referee email blocks assignment (Extension 6a)
**Objective:** Ensure email is required.  
**Preconditions:** Logged in as Editor; paper eligible.  
**Steps:**
1. Open assign referees form for `PAPER-001`.
2. Leave one email entry blank.
3. Confirm.
**Expected Results:**
- System rejects assignment.
- Error message indicates referee email is required.
- No assignments saved/changed.

---

## AT-UC13-06 — Invalid referee email format blocks assignment (Extension 7a)
**Objective:** Validate email format.  
**Preconditions:** Logged in as Editor; paper eligible.  
**Steps:**
1. Enter `ref1@` as a referee email.
2. Confirm.
**Expected Results:**
- System rejects assignment.
- Error identifies invalid email.
- No assignments saved/changed.

---

## AT-UC13-07 — Duplicate emails in entry list are handled (Extension 7b)
**Objective:** Prevent duplicate assignments from same submission list.  
**Preconditions:** Logged in as Editor; paper eligible.  
**Steps:**
1. Enter `ref1@example.com` twice.
2. Confirm assignment.
**Expected Results:**
- System warns about duplicates and ignores/removes duplicates.
- Only one assignment for `ref1@example.com` exists.
- Confirmation indicates unique referees assigned.

---

## AT-UC13-08 — Referee already assigned is not duplicated (Extension 8a)
**Objective:** Prevent duplicate assignment when referee already exists.  
**Preconditions:** `ref1@example.com` is already assigned to `PAPER-001`; logged in as Editor.  
**Steps:**
1. Attempt to assign `ref1@example.com` again (alone or alongside new refs).
2. Confirm assignment.
**Expected Results:**
- System indicates referee already assigned.
- No duplicate record created.
- Any new referees in the list are assigned normally (if provided).

---

## AT-UC13-09 — Database write failure prevents partial assignment (Extension 8b)
**Objective:** Ensure all-or-nothing persistence on failure.  
**Preconditions:** Logged in as Editor; simulate DB write failure.  
**Steps:**
1. Enter valid referee emails (`ref1@example.com`, `ref2@example.com`).
2. Confirm assignment.
**Expected Results:**
- System displays error indicating assignments could not be saved.
- Failure is logged for administrator review.
- No partial assignments appear; referee list remains unchanged from before the attempt.

---

## AT-UC13-10 — Notification failure does not undo assignments (Extension 9a, if applicable)
**Objective:** Ensure graceful handling of notification errors.  
**Preconditions:** Notifications enabled; simulate notification service failure; logged in as Editor.  
**Steps:**
1. Assign `ref1@example.com` to an eligible paper.
2. Force notification sending to fail.
**Expected Results:**
- Assignment is still saved successfully in DB.
- System shows warning that notifications could not be sent.
- Failure is logged; editor can retry notifications if feature exists.

---

# Exit Criteria (Definition of Done for UC-13)
UC-13 is accepted when:
- Editors can assign referees to eligible papers (AT-UC13-01), and
- Authorization/authentication rules are enforced (AT-UC13-02, AT-UC13-03), and
- Input validation prevents blanks/invalid emails and handles duplicates (AT-UC13-05 to AT-UC13-08), and
- Persistence failures fail safely without partial application (AT-UC13-09), and
- Notification failures (if implemented) do not undo assignments and provide clear warnings (AT-UC13-10).
