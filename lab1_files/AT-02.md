# Acceptance Test Suite — UC-02 Validate Registration Email

## Scope
Validate that, during registration, the CMS correctly verifies that a submitted email address is:
1) **valid in format**, and  
2) **unique** (not already registered),  
and that it blocks registration continuation with appropriate errors for the alternate paths.

## Assumptions / Notes
- Email validation includes basic structure checks (e.g., local-part, `@`, domain). Exact rules are not specified; tests expect a clear invalid-format error when rules fail.
- Uniqueness is determined by querying the CMS database for an existing account with the submitted email.
- If the database cannot be reached, the system must **fail safely** (do not allow registration to continue) and log the error.

---

## Test Data
- **Unique valid email**: `unique.uc02@example.com` (not in DB)
- **Existing email**: `existing.uc02@example.com` (pre-seeded in DB)
- **Invalid formats**:
  - Missing @: `invalid.email.example.com`
  - Missing domain: `user@`
  - Missing local-part: `@example.com`
  - Illegal characters example: `user<>@example.com` (use one that your validator rejects)
- **Case-variant email**: `Existing.UC02@Example.com` (same mailbox as `existing.uc02@example.com` if system is case-insensitive)
- **Whitespace variants**: `"  unique.uc02@example.com  "`

---

# Test Cases

## AT-UC02-01 — Valid format and unique email allows registration to continue (Happy Path)
**Objective:** Verify successful validation outcome for a valid, unique email.  
**Preconditions:** User is on registration form; `unique.uc02@example.com` is not in DB.  
**Steps:**
1. Enter `unique.uc02@example.com` into the email field.
2. Submit the registration form (or invoke the validation step if it occurs on submit).
**Expected Results:**
- System confirms email format is valid.
- System queries DB and confirms email does not exist.
- System indicates email is acceptable and allows registration to continue (no blocking error).

---

## AT-UC02-02 — Invalid email format blocks registration continuation (Extension 3a)
**Objective:** Verify that invalid email formats are rejected.  
**Preconditions:** User is on registration form.  
**Steps:**
1. Enter an invalid email (e.g., `user@`).
2. Submit the form.
**Expected Results:**
- System rejects the email as invalid format.
- Error message clearly indicates invalid email format.
- Registration does not proceed to account creation / next step.

---

## AT-UC02-03 — Invalid format does not trigger uniqueness check
**Objective:** Ensure system short-circuits uniqueness check when format is invalid.  
**Preconditions:** User is on registration form; monitoring/logging available to confirm DB query was not made (or DB can be placed in a “fail if queried” state).  
**Steps:**
1. Enter invalid email `invalid.email.example.com`.
2. Submit the form.
**Expected Results:**
- Invalid format error is shown.
- No database lookup is performed for uniqueness (verified by logs/telemetry or DB query count).

---

## AT-UC02-04 — Existing email blocks registration continuation (Extension 4a)
**Objective:** Verify duplicate emails are rejected.  
**Preconditions:** `existing.uc02@example.com` exists in DB; user is on registration form.  
**Steps:**
1. Enter `existing.uc02@example.com`.
2. Submit the form.
**Expected Results:**
- System confirms email format is valid.
- System queries DB and finds matching email.
- Error message indicates email is already registered/in use.
- Registration does not proceed.

---

## AT-UC02-05 — Case-insensitive uniqueness check (recommended)
**Objective:** Ensure duplicates are detected even with different casing (if policy is case-insensitive, which is typical).  
**Preconditions:** `existing.uc02@example.com` exists in DB.  
**Steps:**
1. Enter `Existing.UC02@Example.com`.
2. Submit.
**Expected Results (case-insensitive policy):**
- System treats as already registered and shows duplicate email error.
- Registration does not proceed.
**Note:** If your system is intentionally case-sensitive, update expected results accordingly.

---

## AT-UC02-06 — Leading/trailing whitespace is handled safely (recommended)
**Objective:** Ensure whitespace is trimmed or rejected consistently.  
**Preconditions:** `unique.uc02@example.com` not in DB.  
**Steps:**
1. Enter `  unique.uc02@example.com  ` (with spaces).
2. Submit.
**Expected Results:**
- System either trims whitespace and validates successfully, **or** rejects with a clear invalid email message.
- In either case, behavior is consistent and does not create duplicates accidentally.

---

## AT-UC02-07 — Database query failure blocks registration continuation (Extension 4b)
**Objective:** Verify safe failure when uniqueness cannot be checked.  
**Preconditions:** Configure DB to fail (disconnect/timeout/mock failure); user is on registration form.  
**Steps:**
1. Enter a valid-format email `unique.uc02@example.com`.
2. Submit.
**Expected Results:**
- System confirms email format is valid.
- DB uniqueness check fails.
- System shows an error message indicating email cannot be validated at this time.
- Registration does not proceed.
- Failure is logged for administrator review (verify server logs/monitoring event).

---

## AT-UC02-08 — No account is created when validation fails
**Objective:** Confirm UC-02 failures prevent downstream registration/account creation.  
**Preconditions:** Start from a failure case (AT-UC02-02, AT-UC02-04, or AT-UC02-07).  
**Steps:**
1. Trigger the validation failure.
2. Check the database for the submitted email address.
**Expected Results:**
- No new account exists for the email used in the failed attempt.
- No partial/placeholder record is created.

---

# Exit Criteria (Definition of Done for UC-02)
UC-02 is accepted when:
- AT-UC02-01 through AT-UC02-04 and AT-UC02-07 pass, and
- The system blocks registration continuation for invalid/duplicate/unverifiable emails, and
- Error messages are clear, and
- No accounts are created as a side effect of failed validation.
