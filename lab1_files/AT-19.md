# Acceptance Test Suite — UC-19 Alert Editor When More Than Three Reviewers Are Assigned

## Scope
Validate that CMS alerts editors when a paper has **more than three** reviewers assigned, including:
- detecting over-assignment during assignment actions or on viewing paper,
- notifying editor with count and correction guidance,
- handling batch assignment overflows,
- handling UI notification failures,
- failing safely when reviewer count cannot be determined,
- providing resolution guidance if unassign is not supported,
- optionally blocking the 4th assignment if preventative enforcement is used.

Covers UC-19 extensions (4a, 5a, 3a, 7a, 4b).

## Assumptions / Notes
- The core requirement is **alerting** when reviewer count exceeds three. Some systems may also block the 4th assignment; tests accommodate either if behavior is consistent and communicated.
- “Reviewer” and “referee” are treated as the same role for assignment counting.

---

## Test Data
- **Editor account**: `editor1@example.com`
- **Paper with 3 reviewers**: `PAPER-060` assigned to `r1@example.com`, `r2@example.com`, `r3@example.com`
- **Extra reviewer**: `r4@example.com`
- **Paper with 2 reviewers**: `PAPER-061` assigned to `r1@example.com`, `r2@example.com`

---

# Test Cases

## AT-UC19-01 — Attempting to assign a 4th reviewer triggers alert (Main Path)
**Objective:** Ensure over-assignment is detected and editor is alerted.  
**Preconditions:** Logged in as Editor; `PAPER-060` already has 3 reviewers.  
**Steps:**
1. Open `PAPER-060` and select **Assign Referees**.
2. Attempt to add `r4@example.com`.
3. Confirm assignment.
**Expected Results:**
- System detects reviewer count would become >3.
- System alerts editor that paper has too many reviewers and shows count (4 or “would become 4”).
- System provides guidance/action to correct (remove/replace/cancel).
- Depending on policy:
  - **Preventative**: assignment is blocked and no record created, OR
  - **Flagging**: assignment is created but paper is flagged immediately and editor is guided to fix.

---

## AT-UC19-02 — Viewing a paper already over-assigned shows alert
**Objective:** Ensure detection on view as well as on assignment.  
**Preconditions:** Create an over-assigned state (paper has 4 reviewers) via admin/setup; Editor logged in.  
**Steps:**
1. Open the over-assigned paper details page.
**Expected Results:**
- System displays alert indicating reviewer count is over 3 and shows current count.
- Editor is guided toward corrective actions.

---

## AT-UC19-03 — Batch assignment that would exceed 3 triggers alert and identifies cause (Extension 4a)
**Objective:** Ensure batch assignments handle overflow clearly.  
**Preconditions:** `PAPER-061` has 2 reviewers.  
**Steps:**
1. Attempt to assign two reviewers at once: `r3@example.com` and `r4@example.com`.
2. Confirm batch assignment.
**Expected Results:**
- System detects final count would exceed 3.
- Alert shown; system identifies which addition caused the overflow (e.g., “r4@example.com cannot be added”).
- Behavior matches configured policy:
  - **Partial apply**: only `r3@example.com` assigned; `r4@example.com` blocked, OR
  - **All-or-nothing**: none assigned; alert lists the issue.

---

## AT-UC19-04 — Alert UI fails; alternate feedback still prevents/flags over-assignment (Extension 5a)
**Objective:** Ensure usability and safety even when UI alert fails.  
**Preconditions:** Simulate UI alert component failure; `PAPER-060` has 3 reviewers.  
**Steps:**
1. Attempt to add a 4th reviewer.
**Expected Results:**
- System logs UI notification failure.
- Over-assignment is still prevented or flagged per policy (no silent success).
- Alternate feedback is presented (field highlight, error summary, or status message).

---

## AT-UC19-05 — Reviewer count lookup failure fails safely (Extension 3a)
**Objective:** Ensure system does not allow unknown over-assignment risk.  
**Preconditions:** Simulate DB/lookup failure for reviewer assignments retrieval.  
**Steps:**
1. Attempt to assign a reviewer to a paper.
**Expected Results:**
- System blocks assignment (fail safe) or marks it as pending/unknown (if supported).
- Editor sees message that reviewer count cannot be evaluated at this time.
- Failure is logged for administrator review.

---

## AT-UC19-06 — If unassign is not supported, system provides resolution guidance (Extension 7a)
**Objective:** Ensure editor is not left stuck.  
**Preconditions:** Configure system so editors cannot unassign reviewers; create paper with 4 reviewers.  
**Steps:**
1. Open the over-assigned paper.
**Expected Results:**
- Alert shown about >3 reviewers.
- System provides instructions for resolution (e.g., contact admin, use alternate workflow).
- Paper remains flagged until corrected.

---

## AT-UC19-07 — Preventative enforcement blocks 4th assignment (Extension 4b, if implemented)
**Objective:** Validate hard blocking behavior if chosen design.  
**Preconditions:** Preventative enforcement enabled; `PAPER-060` has 3 reviewers.  
**Steps:**
1. Attempt to add `r4@example.com`.
**Expected Results:**
- Assignment is blocked before save.
- Error clearly states only three reviewers allowed.
- No assignment record exists for the 4th reviewer.

---

# Exit Criteria (Definition of Done for UC-19)
UC-19 is accepted when:
- Editors are alerted whenever reviewer count exceeds three (AT-UC19-01, AT-UC19-02), and
- Batch overflows are detected and clearly explained (AT-UC19-03), and
- UI failures do not result in silent over-assignment (AT-UC19-04), and
- Lookup failures fail safely with clear messaging and logging (AT-UC19-05), and
- Editors are given a workable path to correct over-assignments (AT-UC19-06), and
- If preventative enforcement is used, the 4th assignment is reliably blocked (AT-UC19-07).
