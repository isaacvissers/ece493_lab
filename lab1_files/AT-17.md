# Acceptance Test Suite — UC-17 Ensure Each Paper Has Three Referees Assigned

## Scope
Validate that CMS enforces the policy that each paper must have **exactly three referees assigned** before it can proceed to review, including:
- allowing progression when exactly three referees are assigned,
- blocking progression when fewer than three or more than three are assigned,
- failing safely when referee counts cannot be determined,
- handling invitation delivery issues (optional),
- preventing assignment of a fourth referee (recommended).

Covers UC-17 extensions (3a, 3b, 2a, 5a, 3c).

## Assumptions / Notes
- The policy is interpreted as **exactly three** referees. If your system uses “at least three,” adjust expected results accordingly.
- “Progression to review” may mean changing paper status to “Ready for Review,” enabling review actions, or allowing editor to start review.
- Invitation sending is optional; if not implemented, skip invitation-related expectations.

---

## Test Data
- **Editor account**: `editor1@example.com` (role: Editor)
- **Eligible paper**: `PAPER-040` (Submitted/Eligible)
- **Reviewer emails**: `r1@example.com`, `r2@example.com`, `r3@example.com`, `r4@example.com`

Prepare papers with different referee counts:
- `PAPER-040` with 0 referees (initial state)
- `PAPER-041` with 2 referees
- `PAPER-042` with 3 referees
- `PAPER-043` with 4 referees

---

# Test Cases

## AT-UC17-01 — Paper with exactly three referees can proceed to review (Happy Path)
**Objective:** Ensure readiness check passes at exactly 3.  
**Preconditions:** Logged in as Editor; `PAPER-042` has exactly 3 referees assigned.  
**Steps:**
1. Trigger review readiness checkpoint (e.g., open paper and click **Start Review** / transition to **Ready for Review**).
**Expected Results:**
- System counts referee assignments = 3.
- Paper is allowed to proceed to review (status changes or review actions enabled).
- Confirmation shown; readiness decision is recorded (audit/log if applicable).

---

## AT-UC17-02 — Paper with fewer than three referees is blocked and editor is notified (Extension 3a)
**Objective:** Ensure insufficient referee coverage is prevented.  
**Preconditions:** `PAPER-041` has exactly 2 referees; Editor logged in.  
**Steps:**
1. Trigger review readiness checkpoint for `PAPER-041`.
**Expected Results:**
- System blocks progression to review.
- Message indicates three referees required and shows current count (2).
- System provides action/link to assign additional referees.

---

## AT-UC17-03 — Paper with more than three referees is blocked/flagged and editor is notified (Extension 3b)
**Objective:** Ensure over-assignment is detected and prevented.  
**Preconditions:** `PAPER-043` has 4 referees; Editor logged in.  
**Steps:**
1. Trigger review readiness checkpoint for `PAPER-043`.
**Expected Results:**
- System blocks progression to review (or flags paper as needing correction).
- Message indicates policy violation: too many referees, shows current count (4).
- System provides resolution guidance (unassign/remove or escalate), depending on features.

---

## AT-UC17-04 — Assignment count lookup failure blocks progression (Extension 2a)
**Objective:** Fail safely when referee count cannot be determined.  
**Preconditions:** Simulate DB/lookup failure for referee assignments retrieval; Editor logged in.  
**Steps:**
1. Trigger review readiness checkpoint for an eligible paper.
**Expected Results:**
- System blocks progression (fail safe).
- Error message indicates readiness cannot be evaluated at this time.
- Failure is logged for administrator review.
- No status change to “Ready for Review.”

---

## AT-UC17-05 — Invitations not sent to all three referees are flagged (Extension 5a, if applicable)
**Objective:** Ensure invitation delivery problems are visible.  
**Preconditions:** Paper has exactly 3 assigned referees; simulate notification failure for at least one recipient.  
**Steps:**
1. Trigger the point where system sends/ensures invitations (assignment time or readiness checkpoint).
**Expected Results:**
- Paper still shows 3 assigned referees.
- System warns editor that one or more invitations failed.
- Failure is logged; resend option available if supported.

---

## AT-UC17-06 — Editor cannot assign a fourth referee when three are already assigned (Extension 3c, recommended)
**Objective:** Prevent adding a 4th referee beyond policy.  
**Preconditions:** `PAPER-042` has 3 referees; Editor logged in.  
**Steps:**
1. Open `PAPER-042` and attempt to assign an additional referee `r4@example.com`.
2. Confirm assignment.
**Expected Results:**
- System blocks the assignment.
- Message indicates only three referees are allowed.
- Suggests replacement rather than addition (if replacement is supported).
- Referee count remains 3.

---

## AT-UC17-07 — Recovery: adding missing referee enables readiness
**Objective:** Ensure editor can resolve insufficient count and proceed.  
**Preconditions:** `PAPER-041` has 2 referees.  
**Steps:**
1. Assign a third referee to `PAPER-041`.
2. Trigger review readiness checkpoint again.
**Expected Results:**
- Referee count becomes 3.
- Readiness check passes and paper proceeds to review.

---

# Exit Criteria (Definition of Done for UC-17)
UC-17 is accepted when:
- Papers proceed only when exactly three referees are assigned (AT-UC17-01), and
- Papers with <3 or >3 are blocked/flagged with clear guidance (AT-UC17-02, AT-UC17-03), and
- Lookup failures fail safely with error + logging (AT-UC17-04), and
- Invitation failures are visible without corrupting assignment state (AT-UC17-05, if applicable), and
- System prevents adding a fourth referee (AT-UC17-06, if implemented), and
- Editors can resolve missing referees and proceed (AT-UC17-07).
