# Acceptance Test Suite — UC-07 Change Password

## Scope
Validate that a logged-in registered user can change their password, and that CMS:
- verifies the **current password**,
- validates the **new password** against security standards,
- updates the password in the database,
- confirms success to the user,
and handles all UC-07 extensions (4a, 6a, 7a, 7b, 8a, 2a).

## Assumptions / Notes
- Password policy rules are not defined in the SRS; tests use example passwords and should be adjusted to match your implemented policy.
- The change password feature requires an authenticated session (or forces re-authentication if session is expired).
- If password confirmation is not implemented, skip the confirmation-specific tests (7b).

---

## Test Data
Pre-seed the CMS database with a valid account:

- **User identifier**: `changepw.user@example.com`
- **Current password**: `OldPassw0rd!`
- **New compliant password**: `NewPassw0rd!`
- **New non-compliant password**: `Ab1!` (too short; adjust as needed)
- **Mismatched confirmation**: `NewPassw0rd!!`

---

# Test Cases

## AT-UC07-01 — Change password succeeds with correct current password and compliant new password (Happy Path)
**Objective:** Validate end-to-end success.  
**Preconditions:** User is logged in as `changepw.user@example.com`; policy available.  
**Steps:**
1. Navigate to account/security settings.
2. Select **Change Password**.
3. Enter current password `OldPassw0rd!`.
4. Enter new password `NewPassw0rd!` (and matching confirmation if required).
5. Submit.
**Expected Results:**
- System verifies current password is correct.
- System validates new password against policy successfully.
- System updates the password in the database.
- System displays success confirmation.
- User remains authenticated (unless system design forces re-login).

---

## AT-UC07-02 — User cannot change password with blank required fields (Extension 4a)
**Objective:** Ensure required field validation.  
**Preconditions:** User is logged in.  
**Steps:**
1. Open **Change Password** form.
2. Leave one required field blank (e.g., current password).
3. Submit.
**Expected Results:**
- Request is rejected.
- Error message indicates required fields are missing.
- Password is not changed in the database.

---

## AT-UC07-03 — Incorrect current password blocks change (Extension 6a)
**Objective:** Ensure current password verification prevents unauthorized changes.  
**Preconditions:** User is logged in.  
**Steps:**
1. Open **Change Password** form.
2. Enter incorrect current password (e.g., `WrongOldPassw0rd!`).
3. Enter compliant new password `NewPassw0rd!` (and matching confirmation if required).
4. Submit.
**Expected Results:**
- System rejects request.
- Error indicates current password is incorrect.
- Password remains unchanged in the database.

---

## AT-UC07-04 — New password not compliant is rejected (Extension 7a)
**Objective:** Ensure new password policy is enforced.  
**Preconditions:** User is logged in; policy available.  
**Steps:**
1. Open **Change Password** form.
2. Enter correct current password `OldPassw0rd!`.
3. Enter non-compliant new password `Ab1!`.
4. Submit.
**Expected Results:**
- System verifies current password.
- System rejects new password for failing security standards.
- Error message indicates new password does not meet standards.
- Password remains unchanged in the database.

---

## AT-UC07-05 — New password confirmation mismatch is rejected (Extension 7b, if applicable)
**Objective:** Ensure confirmation must match new password.  
**Preconditions:** User is logged in; confirmation field exists.  
**Steps:**
1. Open **Change Password** form.
2. Enter correct current password `OldPassw0rd!`.
3. Enter new password `NewPassw0rd!`.
4. Enter confirmation `NewPassw0rd!!` (different).
5. Submit.
**Expected Results:**
- System rejects request.
- Error message indicates passwords do not match.
- Password remains unchanged in the database.

---

## AT-UC07-06 — Database update failure does not change password (Extension 8a)
**Objective:** Ensure safe failure when DB write fails.  
**Preconditions:** User is logged in; simulate DB write failure/timeout.  
**Steps:**
1. Submit a valid password change request (correct current password and compliant new password).
**Expected Results:**
- System reports password could not be changed at this time.
- System logs the failure for administrator review (verify logs/monitoring event).
- Password is not changed (verify by attempting login with new password fails, old password still works).

---

## AT-UC07-07 — Session expired forces login before changing password (Extension 2a)
**Objective:** Ensure authentication is required.  
**Preconditions:** User session is expired or user is logged out.  
**Steps:**
1. Attempt to access account/security settings or **Change Password** directly.
**Expected Results:**
- System redirects user to login page.
- User must authenticate before accessing change password functionality.
- No password change is possible without login.

---

## AT-UC07-08 — New password works for subsequent login; old password no longer works
**Objective:** Verify persistence and correctness of password change.  
**Preconditions:** Complete AT-UC07-01 successfully.  
**Steps:**
1. Log out.
2. Attempt login with old password `OldPassw0rd!`.
3. Attempt login with new password `NewPassw0rd!`.
**Expected Results:**
- Login with old password is rejected.
- Login with new password succeeds and grants access.

---

# Exit Criteria (Definition of Done for UC-07)
UC-07 is accepted when:
- AT-UC07-01, AT-UC07-03, AT-UC07-04, AT-UC07-06, AT-UC07-07, and AT-UC07-08 pass, and
- The system prevents password changes when required fields are missing or invalid, and
- No password is changed on failed validations or failed DB updates, and
- Users must be authenticated to change their password.
