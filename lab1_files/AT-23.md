# Acceptance Test Suite — UC-23 Send Completed Reviews to the Editor

## Scope
Validate that when reviewers complete (submit) reviews, CMS:
- makes submitted reviews available to the editor in-app,
- optionally notifies the editor,
- avoids duplicate notifications/delivery,
- handles notification failures without losing reviews,
- handles missing editor mapping, permission issues, batching behavior, and audit/log failures,
- does not attempt delivery when review submission fails.

Covers UC-23 extensions (2a, 5a, 4a, 7a, 3a, 6a, 8a).

## Assumptions / Notes
- “Send to editor” is interpreted as **in-app availability** plus optional notifications (email/in-app alert).
- Notification sending can be tested via email sandbox/queue inspection or in-app notification list.
- If system notifies only after all reviews are in, adjust tests accordingly (here we expect notification per submitted review or batched).

---

## Test Data
- **Editor account**: `editor1@example.com`
- **Reviewer accounts**: `reviewer1@example.com`, `reviewer2@example.com`, `reviewer3@example.com`
- **Paper**: `PAPER-100` managed by editor1
- Assignments accepted for all three reviewers; review period open.
- Failure modes: notification service failure; editor mapping missing; permission misconfig; audit/log failure.

---

# Test Cases

## AT-UC23-01 — After a review is submitted, it appears in editor’s in-app review list (Happy Path)
**Objective:** Ensure delivery via in-app visibility.  
**Preconditions:** Reviewer1 accepted assignment for `PAPER-100`; editor1 manages paper; system operational.  
**Steps:**
1. Reviewer1 submits a valid review for `PAPER-100` (UC-21 happy path).
2. Editor1 logs into CMS and opens `PAPER-100` reviews section.
**Expected Results:**
- Review is stored as **Submitted**.
- Editor1 can see the newly submitted review in the reviews list/details.
- Review content matches what reviewer submitted.

---

## AT-UC23-02 — Editor notification is generated on submitted review (if notifications enabled)
**Objective:** Ensure editor is notified when configured.  
**Preconditions:** Notifications enabled; email/in-app alert channel available.  
**Steps:**
1. Reviewer1 submits a valid review for `PAPER-100`.
2. Inspect editor notification channel (email sandbox/queue or in-app notifications).
**Expected Results:**
- A notification exists indicating a review was submitted for `PAPER-100`.
- Notification references the correct paper and/or reviewer (as designed).
- Notification does not expose sensitive information beyond policy.

---

## AT-UC23-03 — Notification service failure does not prevent editor from accessing review (Extension 5a)
**Objective:** Ensure resilience to notification outages.  
**Preconditions:** Simulate notification service failure; notifications enabled.  
**Steps:**
1. Reviewer1 submits a valid review for `PAPER-100`.
2. Editor1 opens `PAPER-100` reviews section in CMS.
**Expected Results:**
- Review is still stored as **Submitted** and visible to editor in-app.
- Notification send fails and is logged.
- System may show warning in admin logs; optional retry/resend exists if supported.

---

## AT-UC23-04 — If review submission fails, no delivery/notification occurs (Extension 2a)
**Objective:** Ensure delivery is triggered only on successful submission.  
**Preconditions:** Configure validation failure (e.g., missing required field) or DB save failure on submit.  
**Steps:**
1. Reviewer1 attempts to submit an invalid review (fails validation) OR force DB failure during submission.
2. Editor1 checks `PAPER-100` reviews section and notifications.
**Expected Results:**
- Review is not marked as Submitted.
- Editor does not see a new submitted review record.
- No new editor notification is sent for that failed submission attempt.

---

## AT-UC23-05 — Missing editor mapping flags issue and logs error (Extension 4a)
**Objective:** Ensure safe handling when editor cannot be determined.  
**Preconditions:** Misconfigure `PAPER-100` so no editor is assigned/determinable.  
**Steps:**
1. Reviewer1 submits a valid review for `PAPER-100`.
2. Check system status/flags for the paper and logs.
**Expected Results:**
- Review is stored as Submitted.
- System flags paper/review as needing administrative attention.
- Error is logged indicating editor could not be determined.
- No incorrect editor receives the review.

---

## AT-UC23-06 — Editor permission misconfiguration prevents access and is logged (Extension 7a)
**Objective:** Ensure authorization errors are clear and recorded.  
**Preconditions:** Configure editor1 to lack permission to view reviews for `PAPER-100` (misconfig).  
**Steps:**
1. Reviewer1 submits a valid review.
2. Editor1 attempts to view `PAPER-100` reviews section.
**Expected Results:**
- Access denied message shown to editor.
- Authorization/configuration error logged.
- Review remains stored; access works once permissions corrected.

---

## AT-UC23-07 — Duplicate delivery attempts do not create duplicate notifications (Extension 3a)
**Objective:** Ensure idempotency.  
**Preconditions:** Ability to replay delivery job/event for same review.  
**Steps:**
1. Reviewer1 submits a valid review.
2. Force a duplicate delivery processing event (retry job or replay message).
3. Check editor notifications and review list.
**Expected Results:**
- Review appears only once in editor’s review list.
- At most one notification is sent for that review (or duplicates are suppressed).
- System logs may show deduplication occurred (optional).

---

## AT-UC23-08 — Multiple reviews submitted close together are all delivered; notifications are grouped or separate (Extension 6a)
**Objective:** Validate batch behavior.  
**Preconditions:** Reviewer1/2/3 assigned and accepted for `PAPER-100`; notifications enabled if applicable.  
**Steps:**
1. Reviewer1, Reviewer2, Reviewer3 each submit a review within a short time window.
2. Editor1 opens `PAPER-100` reviews section.
3. Inspect notifications.
**Expected Results:**
- All three submitted reviews are visible to editor.
- Notifications are either:
  - one per review, OR
  - a grouped notification, per configuration.
- No reviews are missing from editor view.

---

## AT-UC23-09 — Audit/log failure after delivery does not remove editor access (Extension 8a)
**Objective:** Ensure logging issues don’t break delivery.  
**Preconditions:** Simulate audit/log write failure after delivery step.  
**Steps:**
1. Reviewer1 submits a valid review.
2. Force audit/log write failure after delivery processing.
3. Editor1 opens reviews section.
**Expected Results:**
- Review is visible to editor (delivery successful).
- Audit/log failure recorded in system logs/monitoring.
- No rollback of review visibility occurs.

---

# Exit Criteria (Definition of Done for UC-23)
UC-23 is accepted when:
- Submitted reviews are reliably visible to the correct editor in CMS (AT-UC23-01), and
- Notifications are sent when enabled, but failures do not prevent editor access (AT-UC23-02, AT-UC23-03), and
- Delivery is triggered only after successful submission (AT-UC23-04), and
- Missing editor mapping, permission issues, duplicates, batching, and logging failures are handled safely with clear logging/feedback (AT-UC23-05 to AT-UC23-09).
