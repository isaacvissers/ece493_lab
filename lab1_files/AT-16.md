# Acceptance Test Suite — UC-16 Receive Review Invitation by Email

## Scope
Validate that a reviewer receives a review invitation by email and can accept or reject the assignment, and that CMS:
- generates an invitation record,
- sends an email with sufficient details and accept/reject links,
- records the reviewer’s response and updates assignment status,
- handles send failures, link issues, duplicate responses, invalid/missing email addresses, and persistence failures.

Covers UC-16 extensions (4a, 5a, 6a, 6b, 2a, 7a).

## Assumptions / Notes
- Email delivery itself may be simulated (test SMTP, email sandbox, or message queue inspection).
- If the system requires login before accepting/rejecting, adapt expected results accordingly (redirect to login then complete action).
- Invitation expiry window is not specified; link invalid/expired tests assume such a mechanism exists or can be simulated.

---

## Test Data
- **Editor account**: `editor1@example.com` (role: Editor)
- **Reviewer email**: `reviewer1@example.com`
- **Invalid reviewer email**: `reviewer1@`
- **Eligible paper**: `PAPER-030` (Submitted/Eligible)

Email service:
- Normal mode (send succeeds)
- Failure mode (send fails)
- Link token modes (valid / invalid / expired)

---

# Test Cases

## AT-UC16-01 — Invitation email is generated and sent on reviewer assignment (Happy Path)
**Objective:** Ensure invitation is created and email is sent.  
**Preconditions:** Editor logged in; email service operational; `PAPER-030` eligible.  
**Steps:**
1. Editor assigns `reviewer1@example.com` as referee for `PAPER-030`.
2. Confirm assignment.
3. Inspect outbound email queue/sandbox/inbox for `reviewer1@example.com`.
**Expected Results:**
- Invitation record exists in CMS linked to `PAPER-030` and reviewer email.
- Email is sent to `reviewer1@example.com`.
- Email content includes paper identifier (title/ID) and clear Accept/Reject actions (links/buttons).

---

## AT-UC16-02 — Reviewer accepts invitation via email link; system records response (Happy Path continuation)
**Objective:** Ensure Accept flow works end-to-end.  
**Preconditions:** Invitation email exists with valid Accept link.  
**Steps:**
1. Reviewer opens invitation email.
2. Click **Accept** link.
**Expected Results:**
- CMS validates invitation token.
- Response recorded as “Accepted”.
- Assignment status updated accordingly.
- Reviewer sees confirmation page/message that acceptance was recorded.

---

## AT-UC16-03 — Reviewer rejects invitation via email link; system records response
**Objective:** Ensure Reject flow works end-to-end.  
**Preconditions:** Invitation email exists with valid Reject link.  
**Steps:**
1. Reviewer opens invitation email.
2. Click **Reject** link.
**Expected Results:**
- CMS validates invitation token.
- Response recorded as “Rejected”.
- Assignment status updated accordingly.
- Reviewer sees confirmation page/message that rejection was recorded.

---

## AT-UC16-04 — Email send failure logs issue and leaves invitation pending (Extension 4a)
**Objective:** Ensure safe handling when email service fails.  
**Preconditions:** Simulate email/notification service failure; Editor logged in.  
**Steps:**
1. Editor assigns `reviewer1@example.com` to `PAPER-030`.
2. System attempts to send invitation.
**Expected Results:**
- System records send failure (pending invitation state).
- Editor is warned that invitation could not be sent (or send failure visible in UI/status).
- Failure is logged for administrator review.
- Invitation can be retried/resend is possible (if supported).

---

## AT-UC16-05 — Delivered email not seen: invitation remains pending (Extension 5a)
**Objective:** Ensure pending state remains if reviewer does not respond.  
**Preconditions:** Email sent successfully; reviewer does not click links.  
**Steps:**
1. Wait (or simulate passage of time) without reviewer response.
2. Check invitation/assignment status.
**Expected Results:**
- Invitation remains in “Pending” state.
- No acceptance/rejection recorded.
- If system supports reminders/resend, editor can trigger resend (optional).

---

## AT-UC16-06 — Invalid/expired accept/reject link shows error and does not record response (Extension 6a)
**Objective:** Ensure invalid tokens fail safely.  
**Preconditions:** Create invitation link with invalid token or expired token.  
**Steps:**
1. Reviewer clicks the invalid/expired Accept or Reject link.
**Expected Results:**
- System shows error indicating link is invalid or expired.
- No response is recorded.
- Assignment status remains unchanged.
- Reviewer is instructed to request a new invitation.

---

## AT-UC16-07 — Duplicate response attempt is prevented (Extension 6b)
**Objective:** Ensure reviewer cannot change response by re-clicking links.  
**Preconditions:** Reviewer has already accepted or rejected invitation successfully.  
**Steps:**
1. Reviewer clicks Accept/Reject link again (same invitation).
**Expected Results:**
- System detects response already recorded.
- System shows message that response is already recorded.
- Response is not changed (unless system explicitly supports re-opened invitation).

---

## AT-UC16-08 — Missing/invalid reviewer email prevents sending invitation (Extension 2a)
**Objective:** Ensure a valid reviewer email is required.  
**Preconditions:** Editor logged in.  
**Steps:**
1. Attempt to assign a reviewer with email `reviewer1@` (invalid) or leave email blank.
2. Confirm assignment/invitation.
**Expected Results:**
- System blocks sending invitation.
- Editor receives error that valid reviewer email is required.
- No invitation email is sent.
- Invitation record is not created, or is created in a blocked/error state per design.

---

## AT-UC16-09 — DB failure when recording response shows error and leaves status unchanged (Extension 7a)
**Objective:** Ensure safe failure if response cannot be persisted.  
**Preconditions:** Invitation exists; simulate DB write failure for response recording.  
**Steps:**
1. Reviewer clicks Accept or Reject link.
2. Force DB write failure.
**Expected Results:**
- System shows error indicating response could not be recorded at this time.
- Failure is logged for administrator review.
- Assignment/invitation status remains unchanged (still pending).
- Reviewer can retry later.

---

# Exit Criteria (Definition of Done for UC-16)
UC-16 is accepted when:
- Invitations are generated and email includes Accept/Reject actions (AT-UC16-01), and
- Accept and Reject flows record responses and update status correctly (AT-UC16-02, AT-UC16-03), and
- Send failures, invalid links, duplicate responses, invalid emails, and DB failures are handled safely with clear messaging (AT-UC16-04 to AT-UC16-09).
