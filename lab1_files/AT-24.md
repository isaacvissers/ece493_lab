# Acceptance Test Suite — UC-24 Make Final Accept/Reject Decision After 3 Reviews Are Complete

## Scope
Validate that an editor can record a final **Accept/Reject** decision **only when three reviews are complete**, and that CMS:
- displays eligible papers for decision-making,
- shows the three completed reviews to the editor,
- enforces “exactly 3 completed reviews” prerequisite,
- validates decision selection input,
- persists decision and updates paper status,
- handles authorization errors and system failures,
- optionally notifies authors / triggers downstream workflow without corrupting the decision state.

Covers UC-24 extensions (3a, 3b, 8a, 9a, 7a, 11a).

## Assumptions / Notes
- “3 reviews complete” means **three submitted/complete reviews** are attached to the paper and visible to the editor.
- The user story implies decision can be made when **exactly 3** reviews are complete; if your policy is “at least 3,” adjust tests accordingly.
- Notifications (to authors) and workflow updates (to scheduling) are optional; failures must not roll back the saved decision.

---

## Test Data
- **Editor (authorized)**: `editor1@example.com`
- **Editor (unauthorized)**: `editor2@example.com`
- **Paper with exactly 3 completed reviews**: `PAPER-110`
- **Paper with 2 completed reviews**: `PAPER-111`
- **Paper with 4 completed reviews**: `PAPER-112`
- **Authors for each paper**: `author1@example.com`
- Review statuses:
  - Completed/Submitted = eligible
  - Pending/Draft/Not accepted = not eligible
- Failure simulations:
  - DB write failure on decision save
  - Notification service failure post-save

---

# Test Cases

## AT-UC24-01 — Eligible paper (3 completed reviews) appears in “Papers to Decide” list (Happy Path)
**Objective:** Ensure the system correctly identifies eligible papers.  
**Preconditions:** `PAPER-110` has exactly three completed reviews; editor1 logged in.  
**Steps:**
1. Navigate to **Papers to Decide** (or equivalent decision queue).
**Expected Results:**
- `PAPER-110` appears as eligible for decision-making.
- `PAPER-111` (2 reviews) does not appear (or is clearly marked ineligible).
- `PAPER-112` (4 reviews) does not appear (or is flagged as inconsistent).

---

## AT-UC24-02 — Editor can view the 3 completed reviews for an eligible paper
**Objective:** Ensure decision is based on visible review information.  
**Preconditions:** `PAPER-110` eligible; editor1 logged in.  
**Steps:**
1. Open `PAPER-110` from decision list.
2. Navigate to the reviews section.
**Expected Results:**
- Exactly three completed reviews are displayed.
- Reviews correspond to assigned reviewers and have “Submitted/Complete” status.
- No missing/blank review content is shown as completed.

---

## AT-UC24-03 — Editor records an Accept decision successfully (Happy Path)
**Objective:** Confirm Accept decision is stored and status updates.  
**Preconditions:** `PAPER-110` eligible; editor1 logged in.  
**Steps:**
1. Open `PAPER-110`.
2. Click **Make Decision**.
3. Select **Accept** and optionally enter decision comments.
4. Submit/save decision.
**Expected Results:**
- System validates eligibility (3 reviews) and authorization.
- Decision is saved.
- Paper status becomes **Accepted**.
- Confirmation message is shown.
- Decision and comments (if provided) are visible on paper details.

---

## AT-UC24-04 — Editor records a Reject decision successfully (Happy Path)
**Objective:** Confirm Reject decision is stored and status updates.  
**Preconditions:** Same as AT-UC24-03 but decision = Reject.  
**Steps:**
1. Open `PAPER-110`.
2. Click **Make Decision**.
3. Select **Reject**.
4. Submit/save decision.
**Expected Results:**
- Decision is saved.
- Paper status becomes **Rejected**.
- Confirmation message is shown.

---

## AT-UC24-05 — Paper with fewer than 3 completed reviews cannot be decided (Extension 3a)
**Objective:** Enforce prerequisite “3 completed reviews.”  
**Preconditions:** `PAPER-111` has only 2 completed reviews; editor1 logged in.  
**Steps:**
1. Attempt to open decision entry for `PAPER-111` (from list or direct URL).
2. Click **Make Decision** / attempt to submit decision.
**Expected Results:**
- System prevents decision entry or blocks save.
- Message indicates final decision requires three completed reviews.
- System shows current review count/status (e.g., “2 of 3 complete”).
- No decision is recorded; paper remains undecided.

---

## AT-UC24-06 — Paper with more than 3 reviews triggers alert and blocks decision until corrected (Extension 3b)
**Objective:** Prevent decisions when reviewer count is inconsistent.  
**Preconditions:** `PAPER-112` has 4 completed reviews; editor1 logged in.  
**Steps:**
1. Open `PAPER-112`.
2. Attempt to click **Make Decision** and submit Accept/Reject.
**Expected Results:**
- System alerts editor that the paper has more than three reviews.
- System blocks decision entry/save until the review count is corrected (or applies a documented policy for selecting the correct three).
- Paper remains undecided until issue resolved.

---

## AT-UC24-07 — Unauthorized editor cannot make a decision (Extension 8a)
**Objective:** Enforce authorization for decision entry.  
**Preconditions:** `PAPER-110` eligible; editor2 does not have permission for this paper.  
**Steps:**
1. Log in as editor2.
2. Attempt to open `PAPER-110` decision entry.
**Expected Results:**
- System denies access to decision entry and/or blocks save.
- Authorization error displayed.
- Attempt is logged for admin review (if logging exists).
- No decision is recorded.

---

## AT-UC24-08 — Attempt to submit without selecting Accept/Reject is blocked (Extension 7a)
**Objective:** Validate decision input is required.  
**Preconditions:** `PAPER-110` eligible; editor1 logged in.  
**Steps:**
1. Open `PAPER-110`.
2. Click **Make Decision**.
3. Leave decision selection blank.
4. Click submit/save.
**Expected Results:**
- System blocks save.
- System prompts editor to select **Accept** or **Reject**.
- After selecting a decision, save succeeds.

---

## AT-UC24-09 — DB write failure prevents saving decision and leaves status unchanged (Extension 9a)
**Objective:** Ensure atomic persistence and safe failure.  
**Preconditions:** `PAPER-110` eligible; simulate DB write failure on decision save; editor1 logged in.  
**Steps:**
1. Open `PAPER-110` and choose Accept/Reject.
2. Submit/save decision while DB failure is active.
**Expected Results:**
- System shows error: decision could not be saved.
- Failure logged for admin review.
- Paper status remains unchanged (no partial decision recorded).
- Editor can retry later.

---

## AT-UC24-10 — Notification failure after decision save does not roll back decision (Extension 11a, optional)
**Objective:** Ensure decision persistence is independent of notifications.  
**Preconditions:** Notifications enabled; simulate notification service failure; `PAPER-110` eligible; editor1 logged in.  
**Steps:**
1. Save a valid Accept/Reject decision.
2. Force notification failure after DB save.
3. Reload paper details.
**Expected Results:**
- Decision remains saved and paper status updated.
- System logs notification failure (and optionally shows a warning).
- No rollback occurs; authors can still see decision in CMS when they log in (if that feature exists).

---

# Exit Criteria (Definition of Done for UC-24)
UC-24 is accepted when:
- Editors can decide (Accept/Reject) only for papers with exactly three completed reviews (AT-UC24-03, AT-UC24-04, AT-UC24-05), and
- Over-review-count papers are blocked/flagged as inconsistent (AT-UC24-06), and
- Authorization and input validation are enforced (AT-UC24-07, AT-UC24-08), and
- DB failures and notification failures are handled safely without corrupting decision state (AT-UC24-09, AT-UC24-10).
