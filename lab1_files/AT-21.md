# Acceptance Test Suite — UC-21 Submit Completed Review Form

## Scope
Validate that a reviewer can submit a completed review form and that CMS:
- validates required fields and value ranges,
- stores the review as **Submitted**,
- makes the review visible to the editor,
- blocks submission when review period is closed,
- handles authentication expiry, DB failures, unauthorized submissions, duplicate submissions, and optional notification failures.

Covers UC-21 extensions (4a, 0a, 3a, 5a, 3b, 6a, 8a).

## Assumptions / Notes
- Review form fields/rubric are not specified; test cases assume there are required fields and constrained values.
- If draft saving exists, failures should preserve entered content.
- If notifications exist, failures must not affect successful submission persistence.

---

## Test Data
- **Reviewer account**: `reviewer1@example.com`
- **Editor account**: `editor1@example.com`
- **Assigned paper (accepted)**: `PAPER-080` assigned to reviewer1 (Accepted)
- **Unassigned paper**: `PAPER-081` not assigned to reviewer1
- Review period modes: Open / Closed
- DB write failure simulation
- Notification failure simulation (optional)

---

# Test Cases

## AT-UC21-01 — Reviewer submits valid completed review successfully (Happy Path)
**Objective:** Ensure valid review submission is stored and confirmed.  
**Preconditions:** Reviewer logged in; accepted assignment for `PAPER-080`; review period open; form configured.  
**Steps:**
1. Open review form for `PAPER-080`.
2. Fill all required fields with valid values.
3. Click **Submit Review**.
**Expected Results:**
- System validates inputs successfully.
- Review is stored and status becomes **Submitted**.
- Confirmation message displayed to reviewer.

---

## AT-UC21-02 — Submitted review is visible to editor
**Objective:** Ensure editor can access submitted evaluation.  
**Preconditions:** AT-UC21-01 completed; editor logged in.  
**Steps:**
1. Editor opens `PAPER-080` in editor interface.
2. Navigate to reviews section.
**Expected Results:**
- Submitted review from reviewer1 is visible to editor.
- Review status shown as Submitted; content matches what reviewer entered.

---

## AT-UC21-03 — Validation failure prevents submission and shows actionable errors (Extension 4a)
**Objective:** Ensure incomplete/invalid reviews cannot be submitted.  
**Preconditions:** Review period open; reviewer logged in.  
**Steps:**
1. Leave one required field blank or enter an out-of-range value.
2. Click **Submit Review**.
**Expected Results:**
- Submission is blocked.
- System highlights invalid/missing fields and shows error summary.
- Review status remains Draft/Unsubmitted.
- After correction, reviewer can submit successfully.

---

## AT-UC21-04 — Review period closed blocks submission (Extension 0a)
**Objective:** Enforce deadline rules.  
**Preconditions:** Review period closed; reviewer logged in; review form accessible.  
**Steps:**
1. Attempt to submit a review for `PAPER-080`.
**Expected Results:**
- System blocks submission.
- Message indicates review period is closed.
- No change to submitted state; editing may be disabled/read-only per policy.

---

## AT-UC21-05 — Session expired prompts login and allows retry (Extension 3a)
**Objective:** Ensure auth enforcement and smooth recovery.  
**Preconditions:** Reviewer session expired while on form; review period open.  
**Steps:**
1. Click **Submit Review** with expired session.
2. Log in when prompted.
3. Retry submission.
**Expected Results:**
- System prompts for login.
- After login, reviewer returns to review form.
- Submission succeeds after retry (assuming inputs valid).

---

## AT-UC21-06 — DB write failure prevents submission but preserves content (Extension 5a)
**Objective:** Ensure safe failure without losing review work.  
**Preconditions:** Simulate DB write failure; reviewer logged in; review period open.  
**Steps:**
1. Fill review form with valid values.
2. Click **Submit Review**.
3. Force DB write failure during save.
**Expected Results:**
- System shows error: could not submit at this time.
- Failure logged for admin review.
- Review remains unsubmitted; entered content is preserved (draft retained) if draft feature exists.
- Reviewer can retry later.

---

## AT-UC21-07 — Unauthorized reviewer cannot submit review for unassigned paper (Extension 3b)
**Objective:** Enforce access control on submission.  
**Preconditions:** Reviewer logged in; `PAPER-081` not assigned to reviewer1.  
**Steps:**
1. Attempt to access review form for `PAPER-081` (via URL).
2. Attempt to submit review.
**Expected Results:**
- System denies submission with authorization error.
- No review stored/updated.
- No changes visible to editor for that paper.

---

## AT-UC21-08 — Duplicate submission prevented when review already submitted (Extension 6a)
**Objective:** Prevent multiple submissions of the same review.  
**Preconditions:** Reviewer has already submitted review for `PAPER-080`.  
**Steps:**
1. Reopen the review form for `PAPER-080`.
2. Click **Submit Review** again.
**Expected Results:**
- System indicates review already submitted.
- No duplicate review record created.
- If edits after submission are not allowed, form is locked/read-only.
- If edits after submission are allowed, system follows configured update/resubmit workflow (and is communicated clearly).

---

## AT-UC21-09 — Notification failure does not affect successful submission (Extension 8a, optional)
**Objective:** Ensure submission persists even if notifications fail.  
**Preconditions:** Notification enabled; simulate notification service failure; review period open.  
**Steps:**
1. Submit a valid review.
2. Force notification failure after DB save.
**Expected Results:**
- Review is still stored and marked Submitted.
- Reviewer sees success confirmation (or success + warning about notification).
- Notification failure is logged and can be retried (if supported).
- Editor can still see the submitted review within CMS.

---

# Exit Criteria (Definition of Done for UC-21)
UC-21 is accepted when:
- Valid reviews can be submitted and confirmed (AT-UC21-01), and
- Submitted reviews are visible to editors (AT-UC21-02), and
- Validation, deadlines, auth expiry, DB failures, unauthorized access, and duplicate submissions are handled safely with clear messaging (AT-UC21-03 to AT-UC21-08), and
- Notification failures do not corrupt submission state (AT-UC21-09, if applicable).
